# 如何切换链

## 技术栈

- **Wagmi**: React Hooks 库，提供 `useAccount`、`useSwitchChain` 等 Hook

## 实现概览

- 用 **Wagmi** 的 `useAccount` Hook 获取钱包连接状态和当前链信息
- 用 **Wagmi** 的 `useSwitchChain` Hook 实现链切换功能
- 用 **React** 的 `useState` 管理选中的链 ID 状态
- 用 **React** 的 `useMemo` 同步当前链 ID，避免在 effect 中 setState

## 核心实现详情

### 1. 链选择器组件

```typescript
import { useAccount, useSwitchChain } from "wagmi";
import { mainnet, sepolia } from "wagmi/chains";

// 支持的链列表
const supportedChains = [mainnet, sepolia];

export function ChainSelector({ selectedChainId, onSelectChain }) {
  // 获取当前连接的链信息
  const { chain } = useAccount();
  // 获取切换链的函数和加载状态
  const { switchChain, isPending } = useSwitchChain();

  // 处理链选择
  const handleSelectChain = (chainId: number) => {
    if (chain?.id === chainId) {
      // 如果已经是当前链，只更新选择状态
      onSelectChain(chainId);
    } else {
      // 如果不是当前链，调用 switchChain 切换链
      switchChain({ chainId });
      onSelectChain(chainId);
    }
  };

  return (
    <div>
      {/* 遍历支持的链，渲染链选择按钮，切换链过程中禁用按钮 */}
      {supportedChains.map((supportedChain) => (
        <button
          key={supportedChain.id}
          onClick={() => handleSelectChain(supportedChain.id)}
          disabled={isPending}
        >
          {supportedChain.name}
        </button>
      ))}
    </div>
  );
}
```

### 2. 主页面使用示例

```typescript
import { useAccount } from "wagmi";
import { useState } from "react";
import { ChainSelector } from "./components/ChainSelector";

export default function ChainBalancePage() {
  // 获取当前链和连接状态
  const { chain, isConnected } = useAccount();
  // 管理选中的链 ID 状态，默认使用当前连接的链
  const [selectedChainId, setSelectedChainId] = useState(chain?.id);

  return (
    <main>
      {/* 仅在钱包已连接时显示链选择器 */}
      {isConnected && (
        <ChainSelector
          selectedChainId={selectedChainId}
          onSelectChain={setSelectedChainId}
        />
      )}
    </main>
  );
}
```
