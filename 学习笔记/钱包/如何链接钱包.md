# 如何链接钱包

## 技术栈

- **Wagmi**: React Hooks 库，提供 `useAccount`、`useBalance` 等 Hook
- **RainbowKit**: 钱包连接 UI 组件库，提供 `<ConnectButton />`
- **Viem**: 以太坊工具库，提供 `formatEther` 等工具函数
- **WalletConnect**: 通过 `projectId` 配置，支持移动端钱包连接

## 实现概览

- 用 **RainbowKit** 的 `getDefaultConfig` 和 `RainbowKitProvider` 实现钱包连接配置和 UI 组件
- 用 **Wagmi** 的 `WagmiProvider` 实现钱包状态管理
- 用 **Wagmi** 的 `useAccount` Hook 获取钱包地址和网络信息
- 用 **Wagmi** 的 `useBalance` Hook 查询钱包余额
- 用 **React Query** 的 `QueryClientProvider` 实现区块链数据缓存
- 用 **Viem** 的 `formatEther` 函数格式化余额显示
- 用 **RainbowKit** 的 `ConnectButton` 组件实现连接/断开钱包按钮

## 核心实现详情

### 1. 配置 Providers (`app/providers.tsx`)

```typescript
"use client";

import { getDefaultConfig, RainbowKitProvider } from "@rainbow-me/rainbowkit";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { WagmiProvider } from "wagmi";
import { mainnet, sepolia } from "wagmi/chains";

const projectId = process.env.NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID;

const wagmiConfig = getDefaultConfig({
  appName: "Learn Wagmi",
  projectId,
  chains: [mainnet, sepolia],
  ssr: true,
});

const queryClient = new QueryClient();

export function Web3Providers({ children }) {
  return (
    <WagmiProvider config={wagmiConfig}>
      <QueryClientProvider client={queryClient}>
        <RainbowKitProvider>{children}</RainbowKitProvider>
      </QueryClientProvider>
    </WagmiProvider>
  );
}
```

### 2. 在 Layout 中引入 (`app/layout.tsx`)

```typescript
import "@rainbow-me/rainbowkit/styles.css";
import { Web3Providers } from "./providers";

export default function RootLayout({ children }) {
  return <Web3Providers>{children}</Web3Providers>;
}
```

### 3. 使用钱包连接组件

```typescript
"use client";

import { ConnectButton } from "@rainbow-me/rainbowkit";
import { useAccount, useBalance } from "wagmi";
import { formatEther } from "viem";

export function WalletConnection() {
  // 获取账户信息
  const { address, chain, isConnected } = useAccount();

  // 查询余额
  const { data: balanceData } = useBalance({
    address,
    query: { enabled: Boolean(address) },
  });

  return (
    <>
      <ConnectButton />
      {isConnected && (
        <div>
          <p>地址: {address}</p>
          <p>网络: {chain?.name}</p>
          <p>
            余额: {formatEther(balanceData?.value || 0n)} {balanceData?.symbol}
          </p>
        </div>
      )}
    </>
  );
}
```
