# 如何实现转账

## 技术栈

- **Wagmi**: React Hooks 库，提供 `useSendTransaction` Hook 发送交易、`useWaitForTransactionReceipt` Hook 等待交易确认
- **Viem**: 以太坊工具库，提供 `parseEther` 函数将 ETH 转换为 wei、`isAddress` 函数验证地址格式

## 实现概览

- 用 **Wagmi** 的 `useSendTransaction` Hook 发送转账交易
- 用 **Wagmi** 的 `useWaitForTransactionReceipt` Hook 等待交易确认并获取交易状态
- 用 **Viem** 的 `parseEther` 函数将用户输入的 ETH 金额转换为 wei 单位
- 用 **Viem** 的 `isAddress` 函数验证接收地址格式
- 用 **Wagmi** 的 `useBalance` Hook 查询余额并验证余额是否足够

## 核心实现详情

### 1. 发送转账交易

```typescript
import { useState } from "react";
import { useSendTransaction, useWaitForTransactionReceipt } from "wagmi";
import { parseEther, isAddress } from "viem";

export function Form() {
  const [toAddress, setToAddress] = useState("");
  const [amount, setAmount] = useState("");

  // 发送交易，返回交易哈希和发送函数
  const { data: hash, sendTransaction, isPending } = useSendTransaction();
  // 等待交易确认，hash 变化时会自动查询交易状态
  const { isSuccess: isConfirmed } = useWaitForTransactionReceipt({ hash });

  const handleTransfer = (e) => {
    e.preventDefault();
    
    // 验证地址格式
    if (!isAddress(toAddress)) return;

    // 发送交易，parseEther 将 ETH 字符串转换为 wei（BigInt）
    sendTransaction({
      to: toAddress,
      value: parseEther(amount),
    });
  };

  return (
    <form onSubmit={handleTransfer}>
      <input 
        value={toAddress} 
        onChange={(e) => setToAddress(e.target.value)} 
        placeholder="接收地址"
      />
      <input 
        value={amount} 
        onChange={(e) => setAmount(e.target.value)} 
        placeholder="金额（ETH）"
      />
      <button disabled={isPending}>
        {/* 交易发送中时禁用按钮 */}
        {isPending ? "发送中..." : "发送交易"}
      </button>
      {/* 交易确认后显示成功提示 */}
      {isConfirmed && <div>交易成功！</div>}
    </form>
  );
}
```

### 2. 验证余额

```typescript
import { useState } from "react";
import { useAccount, useBalance } from "wagmi";
import { formatEther } from "viem";

export function Form() {
  const { address } = useAccount();
  const [amount, setAmount] = useState("");
  // 查询当前地址的余额
  const { data: balanceData } = useBalance({ address });

  const handleTransfer = (e) => {
    e.preventDefault();

    // 将余额从 wei 转换为 ETH 并比较
    const balance = parseFloat(formatEther(balanceData.value));
    if (balance < parseFloat(amount)) {
      alert("余额不足");
      return;
    }

    // 余额足够，发送交易...
  };
}
```
